# Template Inheritance and Composition

CronAI supports advanced template inheritance and composition patterns for flexible and modular prompt creation.

## Template Inheritance

Template inheritance allows you to create base templates that define a common structure and extend them with specialized content.

### Basic Syntax

In YAML frontmatter:
```yaml
---
name: Advanced System Check
description: Enhanced system health check
extends: templates/base_system_check
---
```

In template content:
```
{{extends "parent_template"}}

{{block "blockname" .}}
  Content for this block that overrides the parent
{{end}}
```

### How It Works

1. The child template specifies which parent template it extends
2. The child template can override specific blocks defined in the parent
3. Blocks not overridden in the child inherit their content from the parent
4. The template is rendered with the combined structure of parent and child

### Example

**Parent Template (base_report.tmpl):**
```
# {{.Variables.title}}

## Introduction
{{block "introduction" .}}
This is the default introduction.
{{end}}

## Details
{{block "details" .}}
This is the default details section.
{{end}}

Generated on {{.Timestamp.Format "2006-01-02"}}
```

**Child Template (monthly_report.tmpl):**
```
{{extends "base_report"}}

{{block "introduction" .}}
This is the monthly report introduction.
Project: {{.Variables.project}}
{{end}}

{{block "details" .}}
The following metrics were collected:

- Revenue: ${{.Variables.revenue}}
- Expenses: ${{.Variables.expenses}}
- Profit: ${{.Variables.profit}}
{{end}}
```

**Result:**
```
# Monthly Financial Report

## Introduction
This is the monthly report introduction.
Project: CronAI

## Details
The following metrics were collected:

- Revenue: $10000
- Expenses: $6000
- Profit: $4000

Generated on 2025-05-13
```

## Template Composition with Includes

Template composition allows you to include reusable components in your templates.

### Basic Syntax

```
{{include "header"}}

Your content here...

{{include "footer"}}
```

### How It Works

1. The `{{include "template_name"}}` directive is replaced with the content of the named template
2. Templates can be included from:
   - The template library (`templates/library/`)
   - Other prompt files in the `cron_prompts/` directory
   - Absolute paths (for testing purposes)
3. Includes are processed recursively, so included templates can include other templates

### Example

**Component (header.tmpl):**
```
# {{.Variables.title}}
Date: {{.Timestamp.Format "Jan 02, 2006"}}
Author: {{.Variables.author}}

---
```

**Component (footer.tmpl):**
```
---
Generated by CronAI on {{.Timestamp.Format "2006-01-02"}}
```

**Main Template (report.md):**
```
{{include "header"}}

## Content
This is the main content of the report.

{{if hasVar .Variables "includeDetails"}}
## Details
Detailed information goes here.
{{end}}

{{include "footer"}}
```

## Using the Template Library

CronAI includes a library of reusable template components.

### Available Components

| Component | Description | Usage |
|-----------|-------------|-------|
| header.tmpl | Standard document header | `{{include "header"}}` |
| footer.tmpl | Standard document footer | `{{include "footer"}}` |
| alert.tmpl | Notification/alert box | `{{include "alert"}}` |
| table_start.tmpl | Markdown table header | `{{include "table_start"}}` |
| base_report.tmpl | Base template for reports | `{{extends "base_report"}}` |
| email_base.tmpl | Base HTML email template | `{{extends "email_base"}}` |

### Creating Custom Components

You can add your own components to the template library:

1. Create a new file in `templates/library/` with a `.tmpl` extension
2. Use standard Go template syntax
3. Use the component in your templates with `{{include "component_name"}}`

## Combining Inheritance and Composition

You can combine both patterns for maximum flexibility:

```
{{extends "base_template"}}

{{block "header" .}}
  {{include "custom_header"}}
{{end}}

{{block "content" .}}
  Your custom content here...
  {{include "stats_component"}}
{{end}}
```

## Best Practices

1. **Create base templates** for common structures (reports, alerts, emails)
2. **Extract reusable elements** into component templates
3. **Override only what changes** in child templates
4. **Use variables** for dynamic content
5. **Add metadata** to both base templates and components
6. **Document** your templates and components for easier reuse

## Advanced Features

### Nested Inheritance

Templates can extend templates that themselves extend other templates, creating an inheritance chain.

### Conditional Block Overrides

```
{{extends "base_template"}}

{{block "section" .}}
  {{if eq .Variables.environment "production"}}
    Production-specific content
  {{else}}
    Development-specific content
  {{end}}
{{end}}
```

### Block Nesting

Blocks can be nested within other blocks for granular overriding.

```
{{block "main" .}}
  <main>
    {{block "content" .}}Default content{{end}}
    {{block "sidebar" .}}Default sidebar{{end}}
  </main>
{{end}}
```